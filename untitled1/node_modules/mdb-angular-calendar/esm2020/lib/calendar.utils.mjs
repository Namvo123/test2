const MS_IN_DAY = 24 * 60 * 60 * 1000;
const MS_IN_HOUR = 1000 * 60 * 60;
export function getToday() {
    return new Date();
}
export function getDate(date) {
    return date.getDate();
}
export function getDayNumber(date) {
    return date.getDay();
}
export function getMonth(date) {
    return date.getMonth();
}
export function getYear(date) {
    return date.getFullYear();
}
export function getDaysInMonth(date) {
    return getMonthEnd(date).getDate();
}
export function getMonthEnd(date) {
    return createDate(date.getFullYear(), date.getMonth() + 1, 0, 23, 59, 59, 999);
}
export function differenceInDays(dateStart, dateEnd) {
    return Math.floor((dateEnd.getTime() - dateStart.getTime()) / MS_IN_DAY);
}
export function differenceInHours(dateStart, dateEnd) {
    return Math.floor((dateEnd.getTime() - dateStart.getTime()) / MS_IN_HOUR);
}
export function isSameDate(date1, date2) {
    date1.setHours(0, 0, 0, 0);
    date2.setHours(0, 0, 0, 0);
    return date1.getTime() === date2.getTime();
}
export function getFirstDayOfWeek(year, month, mondayFirst) {
    const firstDayIndex = mondayFirst ? 1 : 0;
    const sundayIndex = firstDayIndex > 0 ? 7 - firstDayIndex : 0;
    const date = new Date(year, month);
    const index = getDayNumber(date) + sundayIndex;
    const newIndex = index >= 7 ? index - 7 : index;
    return newIndex;
}
export function addMonths(date, months) {
    const month = createDate(date.getFullYear(), date.getMonth() + months, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds());
    const dayOfPreviousMonth = getDate(date);
    const dayOfNewMonth = getDate(month);
    // Solution for edge cases, like moving from a month with a greater number
    // of days than the destination month. For example, when we move from 31 Mar 2020 to
    // February, createDate(2020, 2, 31) will return 2 Mar 2020, not the desired 29 Feb 2020.
    // We need to use setDate(0) to move back to the last day of the previous month (29 Feb 2020)
    if (dayOfPreviousMonth !== dayOfNewMonth) {
        month.setDate(0);
    }
    return month;
}
export function addDays(date, days) {
    return createDate(date.getFullYear(), date.getMonth(), date.getDate() + days, date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds());
}
export function addHours(date, hours) {
    const currentHour = date.getHours();
    return new Date(date.setHours(currentHour + hours));
}
export function addMinutes(date, minutes) {
    const currentMinutes = date.getMinutes();
    return new Date(date.setMinutes(currentMinutes + minutes));
}
export function startOfDay(date) {
    return new Date(date.setHours(0, 0, 0, 0));
}
export function endOfDay(date) {
    return new Date(date.setHours(23, 59, 59, 999));
}
export function createDate(year, month, day, hours, minutes, seconds, milliseconds) {
    const result = new Date(year, month, day, hours, minutes, seconds, milliseconds);
    // In js native date years from 0 to 99 are treated as abbreviation
    // for dates like 19xx
    if (year >= 0 && year < 100) {
        result.setFullYear(result.getFullYear() - 1900);
    }
    return result;
}
export function format(dateToFormat) {
    let month = getMonth(new Date(dateToFormat)) + 1;
    let day = getDate(new Date(dateToFormat));
    let hours = new Date(dateToFormat).getHours();
    let minutes = new Date(dateToFormat).getMinutes();
    if (month < 10) {
        month = '0' + month;
    }
    if (day < 10) {
        day = '0' + day;
    }
    if (minutes < 10) {
        minutes = '0' + minutes;
    }
    if (hours < 10) {
        hours = '0' + hours;
    }
    let time = `${hours}:${minutes}`;
    const year = getYear(new Date(dateToFormat));
    const date = `${day}/${month}/${year}`;
    const shouldReturnTime = time !== '00:00' && time !== '23:59';
    const string = shouldReturnTime ? `${date} ${time}` : `${date}`;
    return { day, month, year, time, string, date };
}
export function convertDateTo24h(dateTime) {
    let [date, time, modifier] = dateTime.split(' ');
    time = convertTimeTo24h(`${time} ${modifier}`);
    return `${date} ${time}`;
}
export function convertDateTo12h(dateTime) {
    let [date, time] = dateTime.split(' ');
    if (time) {
        time = convertTimeTo12h(time);
    }
    return time ? `${date} ${time}` : `${date}`;
}
export function convertTimeTo24h(timeToFormat) {
    let [time, modifier] = timeToFormat.split(' ');
    let [hours, minutes] = time.split(':');
    if (hours === '12') {
        hours = '00';
    }
    if (modifier === 'PM') {
        hours = `${parseInt(hours, 10) + 12}`;
    }
    return `${hours}:${minutes}`;
}
export function convertTimeTo12h(timeToFormat) {
    let hours;
    let minutes;
    let modifier = 'AM';
    [hours, minutes] = timeToFormat.split(':');
    if (hours === '00') {
        hours = 12;
    }
    else if (hours > 12) {
        hours -= 12;
        hours = hours < 10 ? '0' + hours : hours;
        modifier = 'PM';
    }
    else if (hours === 12) {
        modifier = 'PM';
    }
    return `${hours}:${minutes} ${modifier}`;
}
export function getEvents(events, startDate, endDate, hourEvent = false) {
    if (!events) {
        return;
    }
    let filteredEvents = filterEvents(events, startDate, endDate).sort((a, b) => {
        const aStartDate = a.startDate;
        const bStartDate = b.startDate;
        return aStartDate.getTime() - bStartDate.getTime();
    });
    let result = mapEvents(filteredEvents, startDate, endDate);
    if (hourEvent) {
        return result.filter((event) => !event.allDay && !event.longEvent);
    }
    return result;
}
export function filterEvents(events, startDate, endDate) {
    return events.filter((event) => {
        if (event.startDate >= startDate && event.endDate <= endDate) {
            return true;
        }
        if (event.endDate >= startDate && event.endDate <= endDate) {
            return true;
        }
        if (event.startDate <= startDate && event.endDate >= endDate) {
            return true;
        }
        if (event.startDate >= startDate && event.startDate <= endDate) {
            return true;
        }
        return false;
    });
}
export function mapEvents(events, startDate, endDate) {
    let order = 1;
    events.forEach((event) => {
        const eventStart = event.startDate >= startDate;
        if (eventStart) {
            event.order = order;
            order += 1;
        }
        else {
            order = event.order + 1;
        }
    });
    return events.map((event) => {
        const startData = format(event.startDate);
        const endData = format(event.endDate);
        const eventStartDate = event.startDate;
        const eventEndDate = event.endDate;
        const eventDuration = differenceInDays(eventStartDate, eventEndDate);
        return {
            ...event,
            startData: startData,
            endData: endData,
            eventStart: eventStartDate >= startDate,
            eventEnd: event.endDate <= endDate,
            oneDay: startData.date == endData.date &&
                eventEndDate.getTime() - eventStartDate.getTime() < MS_IN_DAY,
            allDay: eventEndDate.getTime() - eventStartDate.getTime() - eventDuration * MS_IN_DAY ==
                MS_IN_DAY - 1,
            longEvent: eventEndDate.getTime() - eventStartDate.getTime() >= MS_IN_DAY,
        };
    });
}
export function generateEvent(selectionStartDate, selectionEndDate) {
    let startDate = selectionStartDate;
    let endDate = selectionStartDate;
    if (selectionEndDate) {
        startDate = selectionStartDate < selectionEndDate ? selectionStartDate : selectionEndDate;
        endDate = selectionStartDate > selectionEndDate ? selectionStartDate : selectionEndDate;
    }
    const eventDuration = differenceInDays(startDate, endDate);
    const isAllDayEvent = endDate.getTime() - startDate.getTime() - eventDuration * MS_IN_DAY === 0;
    if (isAllDayEvent) {
        startDate = startOfDay(startDate);
        endDate = endOfDay(endDate);
    }
    const newEvent = {
        id: generateUid(),
        summary: '',
        startDate,
        endDate,
        startData: format(startDate),
        endData: format(endDate),
        description: '',
        allDay: isAllDayEvent,
        color: {
            background: 'primary',
        },
    };
    return newEvent;
}
export function generateUid() {
    const uid = Math.random().toString(36).substr(2, 9);
    return `mdb-calendar-event-${uid}`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIudXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9tZGItYW5ndWxhci1jYWxlbmRhci9zcmMvbGliL2NhbGVuZGFyLnV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE1BQU0sU0FBUyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQztBQUN0QyxNQUFNLFVBQVUsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQztBQUVsQyxNQUFNLFVBQVUsUUFBUTtJQUN0QixPQUFPLElBQUksSUFBSSxFQUFFLENBQUM7QUFDcEIsQ0FBQztBQUVELE1BQU0sVUFBVSxPQUFPLENBQUMsSUFBVTtJQUNoQyxPQUFPLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUN4QixDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxJQUFVO0lBQ3JDLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFDLElBQVU7SUFDakMsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDekIsQ0FBQztBQUVELE1BQU0sVUFBVSxPQUFPLENBQUMsSUFBVTtJQUNoQyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUM1QixDQUFDO0FBRUQsTUFBTSxVQUFVLGNBQWMsQ0FBQyxJQUFVO0lBQ3ZDLE9BQU8sV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3JDLENBQUM7QUFFRCxNQUFNLFVBQVUsV0FBVyxDQUFDLElBQVU7SUFDcEMsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFD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QUMsQ0FBQztRQUNsQyxPQUFPLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzdCO0lBRUQsTUFBTSxRQUFRLEdBQUc7UUFDZixFQUFFLEVBQUUsV0FBVyxFQUFFO1FBQ2pCLE9BQU8sRUFBRSxFQUFFO1FBQ1gsU0FBUztRQUNULE9BQU87UUFDUCxTQUFTLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUM1QixPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUN4QixXQUFXLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxhQUFhO1FBQ3JCLEtBQUssRUFBRTtZQUNMLFVBQVUsRUFBRSxTQUFTO1NBQ3RCO0tBQ0YsQ0FBQztJQUVGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFFRCxNQUFNLFVBQVUsV0FBVztJQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDcEQsT0FBTyxzQkFBc0IsR0FBRyxFQUFFLENBQUM7QUFDckMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1kYkNhbGVuZGFyRXZlbnQgfSBmcm9tICcuL2NhbGVuZGFyLmV2ZW50LmludGVyZmFjZSc7XG5cbmNvbnN0IE1TX0lOX0RBWSA9IDI0ICogNjAgKiA2MCAqIDEwMDA7XG5jb25zdCBNU19JTl9IT1VSID0gMTAwMCAqIDYwICogNjA7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUb2RheSgpOiBEYXRlIHtcbiAgcmV0dXJuIG5ldyBEYXRlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREYXRlKGRhdGU6IERhdGUpOiBudW1iZXIge1xuICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREYXlOdW1iZXIoZGF0ZTogRGF0ZSk6IG51bWJlciB7XG4gIHJldHVybiBkYXRlLmdldERheSgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9udGgoZGF0ZTogRGF0ZSk6IG51bWJlciB7XG4gIHJldHVybiBkYXRlLmdldE1vbnRoKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRZZWFyKGRhdGU6IERhdGUpOiBudW1iZXIge1xuICByZXR1cm4gZGF0ZS5nZXRGdWxsWWVhcigpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF5c0luTW9udGgoZGF0ZTogRGF0ZSk6IG51bWJlciB7XG4gIHJldHVybiBnZXRNb250aEVuZChkYXRlKS5nZXREYXRlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNb250aEVuZChkYXRlOiBEYXRlKTogRGF0ZSB7XG4gIHJldHVybiBjcmVhdGVEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpICsgMSwgMCwgMjMsIDU5LCA1OSwgOTk5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpZmZlcmVuY2VJbkRheXMoZGF0ZVN0YXJ0OiBEYXRlLCBkYXRlRW5kOiBEYXRlKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKChkYXRlRW5kLmdldFRpbWUoKSAtIGRhdGVTdGFydC5nZXRUaW1lKCkpIC8gTVNfSU5fREFZKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpZmZlcmVuY2VJbkhvdXJzKGRhdGVTdGFydDogRGF0ZSwgZGF0ZUVuZDogRGF0ZSkge1xuICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZUVuZC5nZXRUaW1lKCkgLSBkYXRlU3RhcnQuZ2V0VGltZSgpKSAvIE1TX0lOX0hPVVIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lRGF0ZShkYXRlMTogRGF0ZSwgZGF0ZTI6IERhdGUpOiBib29sZWFuIHtcbiAgZGF0ZTEuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIGRhdGUyLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuXG4gIHJldHVybiBkYXRlMS5nZXRUaW1lKCkgPT09IGRhdGUyLmdldFRpbWUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpcnN0RGF5T2ZXZWVrKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlciwgbW9uZGF5Rmlyc3Q6IGJvb2xlYW4pOiBudW1iZXIge1xuICBjb25zdCBmaXJzdERheUluZGV4ID0gbW9uZGF5Rmlyc3QgPyAxIDogMDtcbiAgY29uc3Qgc3VuZGF5SW5kZXggPSBmaXJzdERheUluZGV4ID4gMCA/IDcgLSBmaXJzdERheUluZGV4IDogMDtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoKTtcbiAgY29uc3QgaW5kZXggPSBnZXREYXlOdW1iZXIoZGF0ZSkgKyBzdW5kYXlJbmRleDtcbiAgY29uc3QgbmV3SW5kZXggPSBpbmRleCA+PSA3ID8gaW5kZXggLSA3IDogaW5kZXg7XG4gIHJldHVybiBuZXdJbmRleDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1vbnRocyhkYXRlOiBEYXRlLCBtb250aHM6IG51bWJlcik6IERhdGUge1xuICBjb25zdCBtb250aCA9IGNyZWF0ZURhdGUoXG4gICAgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgIGRhdGUuZ2V0TW9udGgoKSArIG1vbnRocyxcbiAgICBkYXRlLmdldERhdGUoKSxcbiAgICBkYXRlLmdldEhvdXJzKCksXG4gICAgZGF0ZS5nZXRNaW51dGVzKCksXG4gICAgZGF0ZS5nZXRTZWNvbmRzKCksXG4gICAgZGF0ZS5nZXRNaWxsaXNlY29uZHMoKVxuICApO1xuICBjb25zdCBkYXlPZlByZXZpb3VzTW9udGggPSBnZXREYXRlKGRhdGUpO1xuICBjb25zdCBkYXlPZk5ld01vbnRoID0gZ2V0RGF0ZShtb250aCk7XG5cbiAgLy8gU29sdXRpb24gZm9yIGVkZ2UgY2FzZXMsIGxpa2UgbW92aW5nIGZyb20gYSBtb250aCB3aXRoIGEgZ3JlYXRlciBudW1iZXJcbiAgLy8gb2YgZGF5cyB0aGFuIHRoZSBkZXN0aW5hdGlvbiBtb250aC4gRm9yIGV4YW1wbGUsIHdoZW4gd2UgbW92ZSBmcm9tIDMxIE1hciAyMDIwIHRvXG4gIC8vIEZlYnJ1YXJ5LCBjcmVhdGVEYXRlKDIwMjAsIDIsIDMxKSB3aWxsIHJldHVybiAyIE1hciAyMDIwLCBub3QgdGhlIGRlc2lyZWQgMjkgRmViIDIwMjAuXG4gIC8vIFdlIG5lZWQgdG8gdXNlIHNldERhdGUoMCkgdG8gbW92ZSBiYWNrIHRvIHRoZSBsYXN0IGRheSBvZiB0aGUgcHJldmlvdXMgbW9udGggKDI5IEZlYiAyMDIwKVxuICBpZiAoZGF5T2ZQcmV2aW91c01vbnRoICE9PSBkYXlPZk5ld01vbnRoKSB7XG4gICAgbW9udGguc2V0RGF0ZSgwKTtcbiAgfVxuXG4gIHJldHVybiBtb250aDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZERheXMoZGF0ZTogRGF0ZSwgZGF5czogbnVtYmVyKTogRGF0ZSB7XG4gIHJldHVybiBjcmVhdGVEYXRlKFxuICAgIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICBkYXRlLmdldE1vbnRoKCksXG4gICAgZGF0ZS5nZXREYXRlKCkgKyBkYXlzLFxuICAgIGRhdGUuZ2V0SG91cnMoKSxcbiAgICBkYXRlLmdldE1pbnV0ZXMoKSxcbiAgICBkYXRlLmdldFNlY29uZHMoKSxcbiAgICBkYXRlLmdldE1pbGxpc2Vjb25kcygpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRIb3VycyhkYXRlOiBEYXRlLCBob3VyczogbnVtYmVyKTogRGF0ZSB7XG4gIGNvbnN0IGN1cnJlbnRIb3VyID0gZGF0ZS5nZXRIb3VycygpO1xuICByZXR1cm4gbmV3IERhdGUoZGF0ZS5zZXRIb3VycyhjdXJyZW50SG91ciArIGhvdXJzKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRNaW51dGVzKGRhdGU6IERhdGUsIG1pbnV0ZXM6IG51bWJlcik6IERhdGUge1xuICBjb25zdCBjdXJyZW50TWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpO1xuICByZXR1cm4gbmV3IERhdGUoZGF0ZS5zZXRNaW51dGVzKGN1cnJlbnRNaW51dGVzICsgbWludXRlcykpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRPZkRheShkYXRlOiBEYXRlKTogRGF0ZSB7XG4gIHJldHVybiBuZXcgRGF0ZShkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuZE9mRGF5KGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuc2V0SG91cnMoMjMsIDU5LCA1OSwgOTk5KSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYXRlKFxuICB5ZWFyOiBudW1iZXIsXG4gIG1vbnRoOiBudW1iZXIsXG4gIGRheTogbnVtYmVyLFxuICBob3VyczogbnVtYmVyLFxuICBtaW51dGVzOiBudW1iZXIsXG4gIHNlY29uZHM6IG51bWJlcixcbiAgbWlsbGlzZWNvbmRzOiBudW1iZXJcbik6IERhdGUge1xuICBjb25zdCByZXN1bHQgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5LCBob3VycywgbWludXRlcywgc2Vjb25kcywgbWlsbGlzZWNvbmRzKTtcblxuICAvLyBJbiBqcyBuYXRpdmUgZGF0ZSB5ZWFycyBmcm9tIDAgdG8gOTkgYXJlIHRyZWF0ZWQgYXMgYWJicmV2aWF0aW9uXG4gIC8vIGZvciBkYXRlcyBsaWtlIDE5eHhcbiAgaWYgKHllYXIgPj0gMCAmJiB5ZWFyIDwgMTAwKSB7XG4gICAgcmVzdWx0LnNldEZ1bGxZZWFyKHJlc3VsdC5nZXRGdWxsWWVhcigpIC0gMTkwMCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdChkYXRlVG9Gb3JtYXQ6IERhdGUpIHtcbiAgbGV0IG1vbnRoOiBudW1iZXIgfCBzdHJpbmcgPSBnZXRNb250aChuZXcgRGF0ZShkYXRlVG9Gb3JtYXQpKSArIDE7XG4gIGxldCBkYXk6IG51bWJlciB8IHN0cmluZyA9IGdldERhdGUobmV3IERhdGUoZGF0ZVRvRm9ybWF0KSk7XG4gIGxldCBob3VyczogbnVtYmVyIHwgc3RyaW5nID0gbmV3IERhdGUoZGF0ZVRvRm9ybWF0KS5nZXRIb3VycygpO1xuICBsZXQgbWludXRlczogbnVtYmVyIHwgc3RyaW5nID0gbmV3IERhdGUoZGF0ZVRvRm9ybWF0KS5nZXRNaW51dGVzKCk7XG5cbiAgaWYgKG1vbnRoIDwgMTApIHtcbiAgICBtb250aCA9ICcwJyArIG1vbnRoO1xuICB9XG5cbiAgaWYgKGRheSA8IDEwKSB7XG4gICAgZGF5ID0gJzAnICsgZGF5O1xuICB9XG5cbiAgaWYgKG1pbnV0ZXMgPCAxMCkge1xuICAgIG1pbnV0ZXMgPSAnMCcgKyBtaW51dGVzO1xuICB9XG5cbiAgaWYgKGhvdXJzIDwgMTApIHtcbiAgICBob3VycyA9ICcwJyArIGhvdXJzO1xuICB9XG5cbiAgbGV0IHRpbWUgPSBgJHtob3Vyc306JHttaW51dGVzfWA7XG5cbiAgY29uc3QgeWVhciA9IGdldFllYXIobmV3IERhdGUoZGF0ZVRvRm9ybWF0KSk7XG4gIGNvbnN0IGRhdGUgPSBgJHtkYXl9LyR7bW9udGh9LyR7eWVhcn1gO1xuICBjb25zdCBzaG91bGRSZXR1cm5UaW1lID0gdGltZSAhPT0gJzAwOjAwJyAmJiB0aW1lICE9PSAnMjM6NTknO1xuICBjb25zdCBzdHJpbmcgPSBzaG91bGRSZXR1cm5UaW1lID8gYCR7ZGF0ZX0gJHt0aW1lfWAgOiBgJHtkYXRlfWA7XG5cbiAgcmV0dXJuIHsgZGF5LCBtb250aCwgeWVhciwgdGltZSwgc3RyaW5nLCBkYXRlIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0RGF0ZVRvMjRoKGRhdGVUaW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBsZXQgW2RhdGUsIHRpbWUsIG1vZGlmaWVyXSA9IGRhdGVUaW1lLnNwbGl0KCcgJyk7XG4gIHRpbWUgPSBjb252ZXJ0VGltZVRvMjRoKGAke3RpbWV9ICR7bW9kaWZpZXJ9YCk7XG5cbiAgcmV0dXJuIGAke2RhdGV9ICR7dGltZX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydERhdGVUbzEyaChkYXRlVGltZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgbGV0IFtkYXRlLCB0aW1lXSA9IGRhdGVUaW1lLnNwbGl0KCcgJyk7XG5cbiAgaWYgKHRpbWUpIHtcbiAgICB0aW1lID0gY29udmVydFRpbWVUbzEyaCh0aW1lKTtcbiAgfVxuXG4gIHJldHVybiB0aW1lID8gYCR7ZGF0ZX0gJHt0aW1lfWAgOiBgJHtkYXRlfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VGltZVRvMjRoKHRpbWVUb0Zvcm1hdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgbGV0IFt0aW1lLCBtb2RpZmllcl0gPSB0aW1lVG9Gb3JtYXQuc3BsaXQoJyAnKTtcbiAgbGV0IFtob3VycywgbWludXRlc10gPSB0aW1lLnNwbGl0KCc6Jyk7XG5cbiAgaWYgKGhvdXJzID09PSAnMTInKSB7XG4gICAgaG91cnMgPSAnMDAnO1xuICB9XG5cbiAgaWYgKG1vZGlmaWVyID09PSAnUE0nKSB7XG4gICAgaG91cnMgPSBgJHtwYXJzZUludChob3VycywgMTApICsgMTJ9YDtcbiAgfVxuXG4gIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VGltZVRvMTJoKHRpbWVUb0Zvcm1hdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgbGV0IGhvdXJzO1xuICBsZXQgbWludXRlcztcbiAgbGV0IG1vZGlmaWVyID0gJ0FNJztcblxuICBbaG91cnMsIG1pbnV0ZXNdID0gdGltZVRvRm9ybWF0LnNwbGl0KCc6Jyk7XG5cbiAgaWYgKGhvdXJzID09PSAnMDAnKSB7XG4gICAgaG91cnMgPSAxMjtcbiAgfSBlbHNlIGlmIChob3VycyA+IDEyKSB7XG4gICAgaG91cnMgLT0gMTI7XG4gICAgaG91cnMgPSBob3VycyA8IDEwID8gJzAnICsgaG91cnMgOiBob3VycztcbiAgICBtb2RpZmllciA9ICdQTSc7XG4gIH0gZWxzZSBpZiAoaG91cnMgPT09IDEyKSB7XG4gICAgbW9kaWZpZXIgPSAnUE0nO1xuICB9XG5cbiAgcmV0dXJuIGAke2hvdXJzfToke21pbnV0ZXN9ICR7bW9kaWZpZXJ9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEV2ZW50cyhcbiAgZXZlbnRzOiBNZGJDYWxlbmRhckV2ZW50W10sXG4gIHN0YXJ0RGF0ZTogRGF0ZSxcbiAgZW5kRGF0ZTogRGF0ZSxcbiAgaG91ckV2ZW50ID0gZmFsc2Vcbik6IE1kYkNhbGVuZGFyRXZlbnRbXSB7XG4gIGlmICghZXZlbnRzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IGZpbHRlcmVkRXZlbnRzID0gZmlsdGVyRXZlbnRzKGV2ZW50cywgc3RhcnREYXRlLCBlbmREYXRlKS5zb3J0KChhLCBiKSA9PiB7XG4gICAgY29uc3QgYVN0YXJ0RGF0ZSA9IGEuc3RhcnREYXRlIGFzIERhdGU7XG4gICAgY29uc3QgYlN0YXJ0RGF0ZSA9IGIuc3RhcnREYXRlIGFzIERhdGU7XG5cbiAgICByZXR1cm4gYVN0YXJ0RGF0ZS5nZXRUaW1lKCkgLSBiU3RhcnREYXRlLmdldFRpbWUoKTtcbiAgfSk7XG5cbiAgbGV0IHJlc3VsdCA9IG1hcEV2ZW50cyhmaWx0ZXJlZEV2ZW50cywgc3RhcnREYXRlLCBlbmREYXRlKTtcblxuICBpZiAoaG91ckV2ZW50KSB7XG4gICAgcmV0dXJuIHJlc3VsdC5maWx0ZXIoKGV2ZW50KSA9PiAhZXZlbnQuYWxsRGF5ICYmICFldmVudC5sb25nRXZlbnQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlckV2ZW50cyhldmVudHM6IGFueSwgc3RhcnREYXRlOiBEYXRlLCBlbmREYXRlOiBEYXRlKTogTWRiQ2FsZW5kYXJFdmVudFtdIHtcbiAgcmV0dXJuIGV2ZW50cy5maWx0ZXIoKGV2ZW50OiBhbnkpID0+IHtcbiAgICBpZiAoZXZlbnQuc3RhcnREYXRlID49IHN0YXJ0RGF0ZSAmJiBldmVudC5lbmREYXRlIDw9IGVuZERhdGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChldmVudC5lbmREYXRlID49IHN0YXJ0RGF0ZSAmJiBldmVudC5lbmREYXRlIDw9IGVuZERhdGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChldmVudC5zdGFydERhdGUgPD0gc3RhcnREYXRlICYmIGV2ZW50LmVuZERhdGUgPj0gZW5kRGF0ZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LnN0YXJ0RGF0ZSA+PSBzdGFydERhdGUgJiYgZXZlbnQuc3RhcnREYXRlIDw9IGVuZERhdGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXBFdmVudHMoXG4gIGV2ZW50czogTWRiQ2FsZW5kYXJFdmVudFtdLFxuICBzdGFydERhdGU6IERhdGUsXG4gIGVuZERhdGU6IERhdGVcbik6IE1kYkNhbGVuZGFyRXZlbnRbXSB7XG4gIGxldCBvcmRlciA9IDE7XG5cbiAgZXZlbnRzLmZvckVhY2goKGV2ZW50OiBNZGJDYWxlbmRhckV2ZW50KSA9PiB7XG4gICAgY29uc3QgZXZlbnRTdGFydCA9IChldmVudC5zdGFydERhdGUgYXMgRGF0ZSkgPj0gc3RhcnREYXRlO1xuXG4gICAgaWYgKGV2ZW50U3RhcnQpIHtcbiAgICAgIGV2ZW50Lm9yZGVyID0gb3JkZXI7XG4gICAgICBvcmRlciArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcmRlciA9IGV2ZW50Lm9yZGVyICsgMTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBldmVudHMubWFwKChldmVudDogTWRiQ2FsZW5kYXJFdmVudCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0RGF0YSA9IGZvcm1hdChldmVudC5zdGFydERhdGUgYXMgRGF0ZSk7XG4gICAgY29uc3QgZW5kRGF0YSA9IGZvcm1hdChldmVudC5lbmREYXRlIGFzIERhdGUpO1xuICAgIGNvbnN0IGV2ZW50U3RhcnREYXRlID0gZXZlbnQuc3RhcnREYXRlIGFzIERhdGU7XG4gICAgY29uc3QgZXZlbnRFbmREYXRlID0gZXZlbnQuZW5kRGF0ZSBhcyBEYXRlO1xuICAgIGNvbnN0IGV2ZW50RHVyYXRpb24gPSBkaWZmZXJlbmNlSW5EYXlzKGV2ZW50U3RhcnREYXRlLCBldmVudEVuZERhdGUgYXMgRGF0ZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uZXZlbnQsXG4gICAgICBzdGFydERhdGE6IHN0YXJ0RGF0YSxcbiAgICAgIGVuZERhdGE6IGVuZERhdGEsXG4gICAgICBldmVudFN0YXJ0OiBldmVudFN0YXJ0RGF0ZSA+PSBzdGFydERhdGUsXG4gICAgICBldmVudEVuZDogZXZlbnQuZW5kRGF0ZSA8PSBlbmREYXRlLFxuICAgICAgb25lRGF5OlxuICAgICAgICBzdGFydERhdGEuZGF0ZSA9PSBlbmREYXRhLmRhdGUgJiZcbiAgICAgICAgZXZlbnRFbmREYXRlLmdldFRpbWUoKSAtIGV2ZW50U3RhcnREYXRlLmdldFRpbWUoKSA8IE1TX0lOX0RBWSxcbiAgICAgIGFsbERheTpcbiAgICAgICAgZXZlbnRFbmREYXRlLmdldFRpbWUoKSAtIGV2ZW50U3RhcnREYXRlLmdldFRpbWUoKSAtIGV2ZW50RHVyYXRpb24gKiBNU19JTl9EQVkgPT1cbiAgICAgICAgTVNfSU5fREFZIC0gMSxcbiAgICAgIGxvbmdFdmVudDogZXZlbnRFbmREYXRlLmdldFRpbWUoKSAtIGV2ZW50U3RhcnREYXRlLmdldFRpbWUoKSA+PSBNU19JTl9EQVksXG4gICAgfTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50KHNlbGVjdGlvblN0YXJ0RGF0ZTogRGF0ZSwgc2VsZWN0aW9uRW5kRGF0ZT86IERhdGUpOiBNZGJDYWxlbmRhckV2ZW50IHtcbiAgbGV0IHN0YXJ0RGF0ZSA9IHNlbGVjdGlvblN0YXJ0RGF0ZTtcbiAgbGV0IGVuZERhdGUgPSBzZWxlY3Rpb25TdGFydERhdGU7XG5cbiAgaWYgKHNlbGVjdGlvbkVuZERhdGUpIHtcbiAgICBzdGFydERhdGUgPSBzZWxlY3Rpb25TdGFydERhdGUgPCBzZWxlY3Rpb25FbmREYXRlID8gc2VsZWN0aW9uU3RhcnREYXRlIDogc2VsZWN0aW9uRW5kRGF0ZTtcbiAgICBlbmREYXRlID0gc2VsZWN0aW9uU3RhcnREYXRlID4gc2VsZWN0aW9uRW5kRGF0ZSA/IHNlbGVjdGlvblN0YXJ0RGF0ZSA6IHNlbGVjdGlvbkVuZERhdGU7XG4gIH1cblxuICBjb25zdCBldmVudER1cmF0aW9uID0gZGlmZmVyZW5jZUluRGF5cyhzdGFydERhdGUsIGVuZERhdGUpO1xuICBjb25zdCBpc0FsbERheUV2ZW50ID0gZW5kRGF0ZS5nZXRUaW1lKCkgLSBzdGFydERhdGUuZ2V0VGltZSgpIC0gZXZlbnREdXJhdGlvbiAqIE1TX0lOX0RBWSA9PT0gMDtcblxuICBpZiAoaXNBbGxEYXlFdmVudCkge1xuICAgIHN0YXJ0RGF0ZSA9IHN0YXJ0T2ZEYXkoc3RhcnREYXRlKTtcbiAgICBlbmREYXRlID0gZW5kT2ZEYXkoZW5kRGF0ZSk7XG4gIH1cblxuICBjb25zdCBuZXdFdmVudCA9IHtcbiAgICBpZDogZ2VuZXJhdGVVaWQoKSxcbiAgICBzdW1tYXJ5OiAnJyxcbiAgICBzdGFydERhdGUsXG4gICAgZW5kRGF0ZSxcbiAgICBzdGFydERhdGE6IGZvcm1hdChzdGFydERhdGUpLFxuICAgIGVuZERhdGE6IGZvcm1hdChlbmREYXRlKSxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgYWxsRGF5OiBpc0FsbERheUV2ZW50LFxuICAgIGNvbG9yOiB7XG4gICAgICBiYWNrZ3JvdW5kOiAncHJpbWFyeScsXG4gICAgfSxcbiAgfTtcblxuICByZXR1cm4gbmV3RXZlbnQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVVpZCgpOiBzdHJpbmcge1xuICBjb25zdCB1aWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gIHJldHVybiBgbWRiLWNhbGVuZGFyLWV2ZW50LSR7dWlkfWA7XG59XG4iXX0=