{"version":3,"file":"mdb-angular-storage-management.mjs","sources":["../../../projects/mdb-angular-storage-management/src/lib/storage-management.service.ts","../../../projects/mdb-angular-storage-management/src/public-api.ts","../../../projects/mdb-angular-storage-management/src/mdb-angular-storage-management.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class MdbStorageManagementService {\n  constructor() {}\n\n  set(name: string, value: any, expires?: number | Date): string {\n    this.checkExpiry();\n\n    localStorage.setItem(name, JSON.stringify(value));\n\n    if (typeof expires === 'number') {\n      const expiryList = this.get('expiryList') || [];\n\n      expires = new Date(Number(new Date()) + expires * 1000 * 60 * 60 * 24);\n\n      if (this.isPresentOnExpiryList(name)) {\n        const index = expiryList.findIndex((el) => el[name] !== undefined);\n        expiryList[index][name] = expires;\n      } else {\n        expiryList.push({ [name]: expires });\n      }\n      localStorage.setItem('expiryList', JSON.stringify(expiryList));\n    }\n\n    return `${name}: ${value}, expiries: ${expires}`;\n  }\n\n  get(name: string): any {\n    this.checkExpiry();\n\n    return JSON.parse(localStorage.getItem(name));\n  }\n\n  remove(name: string): void {\n    this.checkExpiry();\n\n    localStorage.removeItem(name);\n\n    const expiryList = this.get('expiryList') || [];\n\n    if (this.isPresentOnExpiryList(name)) {\n      const filteredList = expiryList.filter((el: {}) => {\n        const elKey = Object.keys(el);\n        return elKey[0] !== name;\n      });\n\n      localStorage.setItem('expiryList', JSON.stringify(filteredList));\n    }\n  }\n\n  isPresentOnExpiryList(name: string) {\n    const expiryList = this.get('expiryList') || [];\n    return expiryList.some((el: {}) => {\n      return el[name] !== undefined;\n    });\n  }\n\n  check(name: string, time: number, callback: () => void): void {\n    const expiryList = this.get('expiryList') || [];\n    const filteredList = expiryList.filter((el: {}) => {\n      const elKey = Object.keys(el);\n      return elKey[0] === name;\n    });\n\n    time *= 6000;\n\n    const intervalId = setInterval(() => {\n      if (!filteredList[0]) {\n        clearInterval(intervalId);\n        return;\n      }\n\n      if (new Date(filteredList[0][name]) < new Date()) {\n        callback();\n        clearInterval(intervalId);\n      }\n\n      this.checkExpiry();\n    }, time);\n  }\n\n  checkExpiry() {\n    const expiryList = JSON.parse(localStorage.getItem('expiryList')) || [];\n    const now = new Date();\n\n    expiryList.filter((el: {}) => {\n      const elKey = Object.keys(el);\n\n      if (now > new Date(el[elKey.toString()])) {\n        localStorage.removeItem(elKey[0]);\n      }\n\n      return el[elKey.toString()] >= now;\n    });\n  }\n}\n","/*\n * Public API Surface of mdb-angular-storage-management\n */\n\nexport * from './lib/storage-management.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}