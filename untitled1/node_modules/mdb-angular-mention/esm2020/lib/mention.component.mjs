import { ActiveDescendantKeyManager } from '@angular/cdk/a11y';
import { Component, EventEmitter, HostListener, Input, Output, ViewChild, ViewChildren, } from '@angular/core';
import { MdbMentionItemComponent } from './mention-item.component';
import { dropdownAnimation, dropdownContainerAnimation } from './mention.animations';
import * as i0 from "@angular/core";
import * as i1 from "./mention-item.component";
import * as i2 from "@angular/common";
export class MdbMentionComponent {
    constructor() {
        this.optionHeight = 35;
        this.noResultText = 'No result found';
        this.visibleItems = 5;
        this.items = [];
        this.queryBy = 'username';
        this.showNoResultText = true;
        this.asyncError = false;
        this.showImg = false;
        this.mentionValue = '';
        this.optionClick = new EventEmitter();
        this.tabout = new EventEmitter();
    }
    ngAfterViewInit() {
        this.keyManager = new ActiveDescendantKeyManager(this.options);
        setTimeout(() => {
            this.keyManager.setFirstItemActive();
        }, 0);
        this.options.changes.subscribe(() => {
            setTimeout(() => {
                this.keyManager.setFirstItemActive();
            }, 0);
        });
        this.keyManager.tabOut.subscribe(() => {
            this.tabout.emit();
        });
    }
    handleKeyDown(event) {
        if (!this.items) {
            return;
        }
        const key = event.code;
        this.keyManager.onKeydown(event);
        switch (key) {
            case 'Home':
                this.keyManager.setFirstItemActive();
                break;
            case 'End':
                this.keyManager.setLastItemActive();
                break;
            case 'Enter':
                const activeItem = this.keyManager.activeItem.item;
                this.handleOptionClick(activeItem);
                break;
        }
        this._moveHighlightedIntoView();
    }
    handleOptionClick(item) {
        this.optionClick.emit(item);
    }
    _setScrollTop(scrollPosition) {
        if (this._dropdownList) {
            this._dropdownList.nativeElement.scrollTop = scrollPosition;
        }
    }
    _moveHighlightedIntoView() {
        const index = this.keyManager.activeItemIndex;
        if (index === 0) {
            this._setScrollTop(0);
        }
        else if (index && index > -1) {
            let newScrollPosition;
            const optionHeight = this.optionHeight;
            const listHeight = this._dropdownList.nativeElement.clientHeight;
            const itemTop = index * optionHeight;
            const itemBottom = itemTop + optionHeight;
            const viewTop = this._dropdownList.nativeElement.scrollTop;
            const viewBottom = viewTop + listHeight;
            if (itemBottom > viewBottom) {
                newScrollPosition = itemBottom - listHeight;
                this._setScrollTop(newScrollPosition);
            }
            else if (itemTop < viewTop) {
                newScrollPosition = itemTop;
                this._setScrollTop(newScrollPosition);
            }
        }
    }
}
MdbMentionComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbMentionComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
MdbMentionComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.2.7", type: MdbMentionComponent, selector: "mdb-mention", inputs: { optionHeight: "optionHeight" }, outputs: { optionClick: "optionClick", tabout: "tabout" }, host: { listeners: { "window:keydown": "handleKeyDown($event)" } }, viewQueries: [{ propertyName: "_dropdownList", first: true, predicate: ["dropdownList"], descendants: true }, { propertyName: "options", predicate: MdbMentionItemComponent, descendants: true }], ngImport: i0, template: "<div [@dropdownContainerAnimation] class=\"mention-dropdown-container\" >\n    <div [@dropdownAnimation] role=\"listbox\" class=\"mention-dropdown\">\n      <ul class=\"mention-items-list\" #dropdownList\n        [ngStyle]=\"{'max-height': optionHeight * visibleItems + 'px'}\">\n        <mention-item\n        *ngFor=\"let item of items\"\n        [mentionValue]=\"mentionValue\"\n        [showImg]=\"showImg\"\n        [queryBy]=\"queryBy\"\n        [optionHeight]=\"optionHeight\"\n        [item]=\"item\"\n        (click)=\"handleOptionClick(item)\"></mention-item>\n        <li\n        *ngIf=\"(items.length === 0 && showNoResultText) || asyncError\"\n        [ngStyle]=\"{'min-height': optionHeight + 'px'}\"\n        class=\"mention-result\">\n        {{ noResultText }}\n      </li>\n      </ul>\n    </div>\n  </div>", components: [{ type: i1.MdbMentionItemComponent, selector: "mention-item", inputs: ["item", "queryBy", "optionHeight", "showImg", "mentionValue"] }], directives: [{ type: i2.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], animations: [dropdownAnimation, dropdownContainerAnimation] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbMentionComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mdb-mention', styles: [], animations: [dropdownAnimation, dropdownContainerAnimation], template: "<div [@dropdownContainerAnimation] class=\"mention-dropdown-container\" >\n    <div [@dropdownAnimation] role=\"listbox\" class=\"mention-dropdown\">\n      <ul class=\"mention-items-list\" #dropdownList\n        [ngStyle]=\"{'max-height': optionHeight * visibleItems + 'px'}\">\n        <mention-item\n        *ngFor=\"let item of items\"\n        [mentionValue]=\"mentionValue\"\n        [showImg]=\"showImg\"\n        [queryBy]=\"queryBy\"\n        [optionHeight]=\"optionHeight\"\n        [item]=\"item\"\n        (click)=\"handleOptionClick(item)\"></mention-item>\n        <li\n        *ngIf=\"(items.length === 0 && showNoResultText) || asyncError\"\n        [ngStyle]=\"{'min-height': optionHeight + 'px'}\"\n        class=\"mention-result\">\n        {{ noResultText }}\n      </li>\n      </ul>\n    </div>\n  </div>" }]
        }], ctorParameters: function () { return []; }, propDecorators: { options: [{
                type: ViewChildren,
                args: [MdbMentionItemComponent]
            }], _dropdownList: [{
                type: ViewChild,
                args: ['dropdownList']
            }], optionHeight: [{
                type: Input
            }], optionClick: [{
                type: Output
            }], tabout: [{
                type: Output
            }], handleKeyDown: [{
                type: HostListener,
                args: ['window:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9tZGItYW5ndWxhci1tZW50aW9uL3NyYy9saWIvbWVudGlvbi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9tZGItYW5ndWxhci1tZW50aW9uL3NyYy9saWIvbWVudGlvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMvRCxPQUFPLEVBRUwsU0FBUyxFQUVULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFFTixTQUFTLEVBQ1QsWUFBWSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7O0FBUXJGLE1BQU0sT0FBTyxtQkFBbUI7SUFDOUI7UUFHUyxpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUUzQixpQkFBWSxHQUFHLGlCQUFpQixDQUFDO1FBQ2pDLGlCQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLFVBQUssR0FBVSxFQUFFLENBQUM7UUFDbEIsWUFBTyxHQUFHLFVBQVUsQ0FBQztRQUNyQixxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDeEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLGlCQUFZLEdBQUcsRUFBRSxDQUFDO1FBRVIsZ0JBQVcsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNwRCxXQUFNLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7SUFmMUMsQ0FBQztJQW1CaEIsZUFBZTtRQUNiLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSwwQkFBMEIsQ0FBMEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hGLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsVUFBVSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDdkMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRU4sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNsQyxVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNkLElBQUksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUN2QyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDUixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFHRCxhQUFhLENBQUMsS0FBb0I7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZixPQUFPO1NBQ1I7UUFDRCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxNQUFNO2dCQUNULElBQUksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztnQkFDckMsTUFBTTtZQUNSLEtBQUssS0FBSztnQkFDUixJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BDLE1BQU07WUFDUixLQUFLLE9BQU87Z0JBQ1YsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO2dCQUNuRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ25DLE1BQU07U0FDVDtRQUNELElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxJQUFTO1FBQ3pCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFTyxhQUFhLENBQUMsY0FBc0I7UUFDMUMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUM7U0FDN0Q7SUFDSCxDQUFDO0lBRU8sd0JBQXdCO1FBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDO1FBRTlDLElBQUksS0FBSyxLQUFLLENBQUMsRUFBRTtZQUNmLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdkI7YUFBTSxJQUFJLEtBQUssSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxpQkFBeUIsQ0FBQztZQUM5QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3ZDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQztZQUVqRSxNQUFNLE9BQU8sR0FBRyxLQUFLLEdBQUcsWUFBWSxDQUFDO1lBQ3JDLE1BQU0sVUFBVSxHQUFHLE9BQU8sR0FBRyxZQUFZLENBQUM7WUFFMUMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO1lBQzNELE1BQU0sVUFBVSxHQUFHLE9BQU8sR0FBRyxVQUFVLENBQUM7WUFDeEMsSUFBSSxVQUFVLEdBQUcsVUFBVSxFQUFFO2dCQUMzQixpQkFBaUIsR0FBRyxVQUFVLEdBQUcsVUFBVSxDQUFDO2dCQUM1QyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUM7YUFDdkM7aUJBQU0sSUFBSSxPQUFPLEdBQUcsT0FBTyxFQUFFO2dCQUM1QixpQkFBaUIsR0FBRyxPQUFPLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQzthQUN2QztTQUNGO0lBQ0gsQ0FBQzs7Z0hBNUZVLG1CQUFtQjtvR0FBbkIsbUJBQW1CLHdWQUVoQix1QkFBdUIsZ0RDeEJ2Qyw0ekJBb0JRLCthREFNLENBQUMsaUJBQWlCLEVBQUUsMEJBQTBCLENBQUM7MkZBRWhELG1CQUFtQjtrQkFQL0IsU0FBUzsrQkFFRSxhQUFhLFVBRWYsRUFBRSxjQUNFLENBQUMsaUJBQWlCLEVBQUUsMEJBQTBCLENBQUM7MEVBSXBCLE9BQU87c0JBQTdDLFlBQVk7dUJBQUMsdUJBQXVCO2dCQUNWLGFBQWE7c0JBQXZDLFNBQVM7dUJBQUMsY0FBYztnQkFDaEIsWUFBWTtzQkFBcEIsS0FBSztnQkFXSSxXQUFXO3NCQUFwQixNQUFNO2dCQUNHLE1BQU07c0JBQWYsTUFBTTtnQkFzQlAsYUFBYTtzQkFEWixZQUFZO3VCQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWN0aXZlRGVzY2VuZGFudEtleU1hbmFnZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NoaWxkcmVuLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1kYk1lbnRpb25JdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9tZW50aW9uLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IGRyb3Bkb3duQW5pbWF0aW9uLCBkcm9wZG93bkNvbnRhaW5lckFuaW1hdGlvbiB9IGZyb20gJy4vbWVudGlvbi5hbmltYXRpb25zJztcbkBDb21wb25lbnQoe1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ21kYi1tZW50aW9uJyxcbiAgdGVtcGxhdGVVcmw6IGBtZW50aW9uLmNvbXBvbmVudC5odG1sYCxcbiAgc3R5bGVzOiBbXSxcbiAgYW5pbWF0aW9uczogW2Ryb3Bkb3duQW5pbWF0aW9uLCBkcm9wZG93bkNvbnRhaW5lckFuaW1hdGlvbl0sXG59KVxuZXhwb3J0IGNsYXNzIE1kYk1lbnRpb25Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgY29uc3RydWN0b3IoKSB7fVxuICBAVmlld0NoaWxkcmVuKE1kYk1lbnRpb25JdGVtQ29tcG9uZW50KSBvcHRpb25zOiBRdWVyeUxpc3Q8TWRiTWVudGlvbkl0ZW1Db21wb25lbnQ+O1xuICBAVmlld0NoaWxkKCdkcm9wZG93bkxpc3QnKSBfZHJvcGRvd25MaXN0OiBFbGVtZW50UmVmO1xuICBASW5wdXQoKSBvcHRpb25IZWlnaHQgPSAzNTtcblxuICBub1Jlc3VsdFRleHQgPSAnTm8gcmVzdWx0IGZvdW5kJztcbiAgdmlzaWJsZUl0ZW1zID0gNTtcbiAgaXRlbXM6IGFueVtdID0gW107XG4gIHF1ZXJ5QnkgPSAndXNlcm5hbWUnO1xuICBzaG93Tm9SZXN1bHRUZXh0ID0gdHJ1ZTtcbiAgYXN5bmNFcnJvciA9IGZhbHNlO1xuICBzaG93SW1nID0gZmFsc2U7XG4gIG1lbnRpb25WYWx1ZSA9ICcnO1xuXG4gIEBPdXRwdXQoKSBvcHRpb25DbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSB0YWJvdXQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGtleU1hbmFnZXI6IEFjdGl2ZURlc2NlbmRhbnRLZXlNYW5hZ2VyPE1kYk1lbnRpb25JdGVtQ29tcG9uZW50PjtcblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5rZXlNYW5hZ2VyID0gbmV3IEFjdGl2ZURlc2NlbmRhbnRLZXlNYW5hZ2VyPE1kYk1lbnRpb25JdGVtQ29tcG9uZW50Pih0aGlzLm9wdGlvbnMpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5rZXlNYW5hZ2VyLnNldEZpcnN0SXRlbUFjdGl2ZSgpO1xuICAgIH0sIDApO1xuXG4gICAgdGhpcy5vcHRpb25zLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmtleU1hbmFnZXIuc2V0Rmlyc3RJdGVtQWN0aXZlKCk7XG4gICAgICB9LCAwKTtcbiAgICB9KTtcblxuICAgIHRoaXMua2V5TWFuYWdlci50YWJPdXQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMudGFib3V0LmVtaXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzprZXlkb3duJywgWyckZXZlbnQnXSlcbiAgaGFuZGxlS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGlmICghdGhpcy5pdGVtcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBrZXkgPSBldmVudC5jb2RlO1xuICAgIHRoaXMua2V5TWFuYWdlci5vbktleWRvd24oZXZlbnQpO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdIb21lJzpcbiAgICAgICAgdGhpcy5rZXlNYW5hZ2VyLnNldEZpcnN0SXRlbUFjdGl2ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0VuZCc6XG4gICAgICAgIHRoaXMua2V5TWFuYWdlci5zZXRMYXN0SXRlbUFjdGl2ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgICAgY29uc3QgYWN0aXZlSXRlbSA9IHRoaXMua2V5TWFuYWdlci5hY3RpdmVJdGVtLml0ZW07XG4gICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uQ2xpY2soYWN0aXZlSXRlbSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICB0aGlzLl9tb3ZlSGlnaGxpZ2h0ZWRJbnRvVmlldygpO1xuICB9XG5cbiAgaGFuZGxlT3B0aW9uQ2xpY2soaXRlbTogYW55KSB7XG4gICAgdGhpcy5vcHRpb25DbGljay5lbWl0KGl0ZW0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfc2V0U2Nyb2xsVG9wKHNjcm9sbFBvc2l0aW9uOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5fZHJvcGRvd25MaXN0KSB7XG4gICAgICB0aGlzLl9kcm9wZG93bkxpc3QubmF0aXZlRWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxQb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9tb3ZlSGlnaGxpZ2h0ZWRJbnRvVmlldygpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMua2V5TWFuYWdlci5hY3RpdmVJdGVtSW5kZXg7XG5cbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIHRoaXMuX3NldFNjcm9sbFRvcCgwKTtcbiAgICB9IGVsc2UgaWYgKGluZGV4ICYmIGluZGV4ID4gLTEpIHtcbiAgICAgIGxldCBuZXdTY3JvbGxQb3NpdGlvbjogbnVtYmVyO1xuICAgICAgY29uc3Qgb3B0aW9uSGVpZ2h0ID0gdGhpcy5vcHRpb25IZWlnaHQ7XG4gICAgICBjb25zdCBsaXN0SGVpZ2h0ID0gdGhpcy5fZHJvcGRvd25MaXN0Lm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXG4gICAgICBjb25zdCBpdGVtVG9wID0gaW5kZXggKiBvcHRpb25IZWlnaHQ7XG4gICAgICBjb25zdCBpdGVtQm90dG9tID0gaXRlbVRvcCArIG9wdGlvbkhlaWdodDtcblxuICAgICAgY29uc3Qgdmlld1RvcCA9IHRoaXMuX2Ryb3Bkb3duTGlzdC5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgIGNvbnN0IHZpZXdCb3R0b20gPSB2aWV3VG9wICsgbGlzdEhlaWdodDtcbiAgICAgIGlmIChpdGVtQm90dG9tID4gdmlld0JvdHRvbSkge1xuICAgICAgICBuZXdTY3JvbGxQb3NpdGlvbiA9IGl0ZW1Cb3R0b20gLSBsaXN0SGVpZ2h0O1xuICAgICAgICB0aGlzLl9zZXRTY3JvbGxUb3AobmV3U2Nyb2xsUG9zaXRpb24pO1xuICAgICAgfSBlbHNlIGlmIChpdGVtVG9wIDwgdmlld1RvcCkge1xuICAgICAgICBuZXdTY3JvbGxQb3NpdGlvbiA9IGl0ZW1Ub3A7XG4gICAgICAgIHRoaXMuX3NldFNjcm9sbFRvcChuZXdTY3JvbGxQb3NpdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2IFtAZHJvcGRvd25Db250YWluZXJBbmltYXRpb25dIGNsYXNzPVwibWVudGlvbi1kcm9wZG93bi1jb250YWluZXJcIiA+XG4gICAgPGRpdiBbQGRyb3Bkb3duQW5pbWF0aW9uXSByb2xlPVwibGlzdGJveFwiIGNsYXNzPVwibWVudGlvbi1kcm9wZG93blwiPlxuICAgICAgPHVsIGNsYXNzPVwibWVudGlvbi1pdGVtcy1saXN0XCIgI2Ryb3Bkb3duTGlzdFxuICAgICAgICBbbmdTdHlsZV09XCJ7J21heC1oZWlnaHQnOiBvcHRpb25IZWlnaHQgKiB2aXNpYmxlSXRlbXMgKyAncHgnfVwiPlxuICAgICAgICA8bWVudGlvbi1pdGVtXG4gICAgICAgICpuZ0Zvcj1cImxldCBpdGVtIG9mIGl0ZW1zXCJcbiAgICAgICAgW21lbnRpb25WYWx1ZV09XCJtZW50aW9uVmFsdWVcIlxuICAgICAgICBbc2hvd0ltZ109XCJzaG93SW1nXCJcbiAgICAgICAgW3F1ZXJ5QnldPVwicXVlcnlCeVwiXG4gICAgICAgIFtvcHRpb25IZWlnaHRdPVwib3B0aW9uSGVpZ2h0XCJcbiAgICAgICAgW2l0ZW1dPVwiaXRlbVwiXG4gICAgICAgIChjbGljayk9XCJoYW5kbGVPcHRpb25DbGljayhpdGVtKVwiPjwvbWVudGlvbi1pdGVtPlxuICAgICAgICA8bGlcbiAgICAgICAgKm5nSWY9XCIoaXRlbXMubGVuZ3RoID09PSAwICYmIHNob3dOb1Jlc3VsdFRleHQpIHx8IGFzeW5jRXJyb3JcIlxuICAgICAgICBbbmdTdHlsZV09XCJ7J21pbi1oZWlnaHQnOiBvcHRpb25IZWlnaHQgKyAncHgnfVwiXG4gICAgICAgIGNsYXNzPVwibWVudGlvbi1yZXN1bHRcIj5cbiAgICAgICAge3sgbm9SZXN1bHRUZXh0IH19XG4gICAgICA8L2xpPlxuICAgICAgPC91bD5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+Il19