import { coerceBooleanProperty, coerceNumberProperty, } from '@angular/cdk/coercion';
import { OverlayConfig, } from '@angular/cdk/overlay';
import { ComponentPortal } from '@angular/cdk/portal';
import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import { Subject, fromEvent } from 'rxjs';
import { filter, takeUntil } from 'rxjs/operators';
import { MdbMentionComponent } from './mention.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/overlay";
export class MdbMentionDirective {
    constructor(_overlay, _overlayPositionBuilder, _elementRef, _renderer) {
        this._overlay = _overlay;
        this._overlayPositionBuilder = _overlayPositionBuilder;
        this._elementRef = _elementRef;
        this._renderer = _renderer;
        this._overlayRef = null;
        this.placement = 'bottom';
        this.trigger = '@';
        this._outputKey = '';
        this._visibleItems = 5;
        this._disableFilter = false;
        this._showListOnTrigger = true;
        this._asyncError = false;
        this._showImg = false;
        this._noResultText = 'No result found';
        this._items = [];
        this._queryBy = 'username';
        this._showNoResultText = true;
        this.mentionChange = new EventEmitter();
        this.mentionClose = new EventEmitter();
        this.mentionOpen = new EventEmitter();
        this.mentionSelect = new EventEmitter();
        this._mentionRef = null;
        this._open = false;
        this._caretPositionIndex = 0;
        this._isTriggerValid = false;
        this._presentTrigger = '';
        this.mentionValue = '';
        this._destroy$ = new Subject();
    }
    get outputKey() {
        return this._outputKey;
    }
    set outputKey(value) {
        this._outputKey = value;
    }
    get visibleItems() {
        return this._visibleItems;
    }
    set visibleItems(value) {
        this._visibleItems = coerceNumberProperty(value);
        if (this._mentionRef) {
            this._mentionRef.instance.visibleItems = this._visibleItems;
        }
    }
    get disableFilter() {
        return this._disableFilter;
    }
    set disableFilter(value) {
        this._disableFilter = coerceBooleanProperty(value);
    }
    get showListOnTrigger() {
        return this._showListOnTrigger;
    }
    set showListOnTrigger(value) {
        this._showListOnTrigger = coerceBooleanProperty(value);
    }
    get asyncError() {
        return this._asyncError;
    }
    set asyncError(value) {
        this._asyncError = coerceBooleanProperty(value);
        if (this._mentionRef) {
            this._mentionRef.instance.asyncError = this._asyncError;
        }
    }
    get showImg() {
        return this._showImg;
    }
    set showImg(value) {
        this._showImg = coerceBooleanProperty(value);
        if (this._mentionRef) {
            this._mentionRef.instance.showImg = this._showImg;
        }
    }
    get noResultText() {
        return this._noResultText;
    }
    set noResultText(value) {
        this._noResultText = value;
        if (this._mentionRef) {
            this._mentionRef.instance.noResultText = value;
        }
    }
    get items() {
        return this._items;
    }
    set items(value) {
        this._items = value ? value : [];
        if (this._mentionRef) {
            this._mentionRef.instance.items = this._items;
        }
    }
    get queryBy() {
        return this._queryBy;
    }
    set queryBy(value) {
        this._queryBy = value;
        if (this._mentionRef) {
            this._mentionRef.instance.queryBy = this._queryBy;
        }
    }
    get showNoResultText() {
        return this._showNoResultText;
    }
    set showNoResultText(value) {
        this._showNoResultText = coerceBooleanProperty(value);
        if (this._mentionRef) {
            this._mentionRef.instance.showNoResultText = this._showNoResultText;
        }
    }
    ngOnInit() {
        this._renderer.setAttribute(this._elementRef.nativeElement, 'autocomplete', 'off');
        this._bindTriggerEvents();
    }
    _getPosition() {
        let position;
        const positionTop = {
            originX: 'start',
            originY: 'top',
            overlayX: 'start',
            overlayY: 'bottom',
            offsetY: 0,
        };
        const positionBottom = {
            originX: 'start',
            originY: 'bottom',
            overlayX: 'start',
            overlayY: 'top',
            offsetY: 0,
        };
        const positionRight = {
            originX: 'end',
            originY: 'center',
            overlayX: 'start',
            overlayY: 'center',
            offsetX: 0,
        };
        const positionLeft = {
            originX: 'start',
            originY: 'center',
            overlayX: 'end',
            overlayY: 'center',
            offsetX: 0,
        };
        switch (this.placement) {
            case 'top':
                position = [positionTop, positionBottom];
                break;
            case 'bottom':
                position = [positionBottom, positionTop];
                break;
            case 'left':
                position = [positionLeft, positionRight];
                break;
            case 'right':
                position = [positionRight, positionLeft];
                break;
            default:
                position = [positionBottom, positionTop];
                break;
        }
        return position;
    }
    _createOverlayConfig() {
        const positionStrategy = this._overlayPositionBuilder
            .flexibleConnectedTo(this._elementRef)
            .withPositions(this._getPosition());
        const overlayConfig = new OverlayConfig({
            width: this._elementRef.nativeElement.offsetWidth,
            hasBackdrop: false,
            scrollStrategy: this._overlay.scrollStrategies.reposition(),
            positionStrategy,
        });
        return overlayConfig;
    }
    _createOverlay() {
        this._overlayRef = this._overlay.create(this._createOverlayConfig());
    }
    _listenToOutSideClick(overlayRef, origin) {
        return fromEvent(document, 'click').pipe(filter((event) => {
            const target = event.target;
            const notOrigin = target !== origin;
            const notOverlay = !!overlayRef && overlayRef.overlayElement.contains(target) === false;
            return notOrigin && notOverlay;
        }), takeUntil(overlayRef.detachments()));
    }
    _handleOptionClick(item) {
        this.mentionSelect.emit(item);
        this._setHostValue(item);
        this.close();
    }
    _setDataForDropdown() {
        let filtereditems;
        if (!this._disableFilter) {
            filtereditems = this._filter(this.mentionValue);
            this._mentionRef.instance.items = filtereditems ? filtereditems : this._items;
        }
        this._mentionRef.instance.mentionValue = this.mentionValue;
    }
    _updateMentionString(caretPositionIndex) {
        const hostValueBeforeCaret = this._elementRef.nativeElement.value.slice(0, caretPositionIndex);
        const triggers = [...this.trigger];
        if (!this._caretPositionIndex) {
            this.mentionValue = '';
            this._isTriggerValid = false;
            return;
        }
        for (let i = hostValueBeforeCaret.length - 1; i >= 0; i--) {
            if (hostValueBeforeCaret.charAt(i) === ' ') {
                this.mentionValue = '';
                this._isTriggerValid = false;
                return;
            }
            if (triggers.some((trigger) => trigger === hostValueBeforeCaret.charAt(i))) {
                if (hostValueBeforeCaret.charAt(i - 1) !== ' ' && i > 1) {
                    return;
                }
                const trigger = hostValueBeforeCaret.charAt(i);
                const hostValueAfterTrigger = this._elementRef.nativeElement.value.slice(i);
                const mentionValues = hostValueAfterTrigger.split(' ')[0];
                const mentionValue = mentionValues.split(trigger)[1] ? mentionValues.split(trigger)[1] : '';
                this.mentionValue = mentionValue;
                this._isTriggerValid = true;
                this._presentTrigger = trigger;
                this.mentionChange.emit({
                    trigger: trigger,
                    searchTerm: this.mentionValue,
                });
                return;
            }
        }
    }
    _toggleDropdown() {
        if (!this._open && this._isTriggerValid) {
            if (!this._showListOnTrigger && this.mentionValue.length < 1) {
                return;
            }
            this.open();
            this._mentionRef.instance.queryBy = this.queryBy;
            this._mentionRef.instance.noResultText = this._noResultText;
            this._mentionRef.instance.showNoResultText = this._showNoResultText;
            this._mentionRef.instance.asyncError = this._asyncError;
            this._mentionRef.instance.showImg = this._showImg;
            this._mentionRef.instance.visibleItems = this._visibleItems;
            return;
        }
        if (!this._isTriggerValid) {
            this.close();
        }
    }
    _handleDropdownByCaret(event) {
        const target = event.target;
        this._caretPositionIndex = target.selectionStart;
        this._updateMentionString(this._caretPositionIndex);
        this._toggleDropdown();
        if (!this._open) {
            return;
        }
        this._setDataForDropdown();
    }
    _bindTriggerEvents() {
        fromEvent(this._elementRef.nativeElement, 'click')
            .pipe(takeUntil(this._destroy$))
            .subscribe((event) => {
            this._handleDropdownByCaret(event);
        });
        fromEvent(this._elementRef.nativeElement, 'keydown')
            .pipe(takeUntil(this._destroy$))
            .subscribe((event) => {
            const { key } = event;
            const isKeyEscape = key === 'Escape';
            const isKeyResponsibleForTabout = key === 'Tab';
            const isKeyResponsibleForDropdownNavigation = ['ArrowUp', 'ArrowDown', 'Escape', 'Home', 'End', 'Enter'].indexOf(key) > -1;
            if (isKeyResponsibleForDropdownNavigation) {
                if (isKeyEscape) {
                    this.close();
                }
                event.preventDefault();
                return;
            }
            if (isKeyResponsibleForTabout) {
                return;
            }
            setTimeout(() => {
                this._handleDropdownByCaret(event);
            }, 0);
        });
    }
    _setHostValue(value) {
        const hostValueBeforeCaret = this._elementRef.nativeElement.value.slice(0, this._caretPositionIndex);
        for (let i = hostValueBeforeCaret.length - 1; i >= 0; i--) {
            if (hostValueBeforeCaret.charAt(i) === ' ') {
                return;
            }
            if (hostValueBeforeCaret.charAt(i) === this._presentTrigger) {
                const hostValueBeforeTrigger = this._elementRef.nativeElement.value.slice(0, i);
                const hostValueAfterTrigger = this._elementRef.nativeElement.value.slice(i);
                const hostNewValueAfterTrigger = hostValueAfterTrigger.split(' ')[1]
                    ? hostValueAfterTrigger.split(' ').splice(1).join(' ')
                    : '';
                this._elementRef.nativeElement.value = hostValueBeforeTrigger.concat(this._presentTrigger, value[this._outputKey ? this._outputKey : this._queryBy], ' ', hostNewValueAfterTrigger);
            }
        }
    }
    _filter(value) {
        const filterValue = value.toLowerCase();
        const filtereditems = this._items.filter((item) => item[this._queryBy].toLowerCase().includes(filterValue));
        return filtereditems;
    }
    open() {
        if (this._open) {
            return;
        }
        if (!this._overlayRef) {
            this._createOverlay();
        }
        if (this._overlayRef.hasAttached()) {
            this._overlayRef.detach();
        }
        const mentionPortal = new ComponentPortal(MdbMentionComponent);
        this._mentionRef = this._overlayRef.attach(mentionPortal);
        this._open = true;
        this._mentionRef.instance.optionClick.subscribe((item) => {
            this._handleOptionClick(item);
        });
        this._mentionRef.instance.tabout.subscribe(() => {
            this.close();
        });
        this._listenToOutSideClick(this._overlayRef, this._elementRef.nativeElement).subscribe(() => this.close());
        this.mentionOpen.emit();
    }
    close() {
        if (this._overlayRef) {
            if (this._overlayRef.hasAttached()) {
                this._overlayRef.detach();
            }
        }
        if (this._open) {
            this._open = false;
        }
        this.mentionClose.emit();
    }
    ngOnDestroy() {
        this._destroy$.next();
        this._destroy$.complete();
        if (this._overlayRef) {
            this.close();
            this._overlayRef.dispose();
            this._overlayRef = null;
        }
    }
}
MdbMentionDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbMentionDirective, deps: [{ token: i1.Overlay }, { token: i1.OverlayPositionBuilder }, { token: i0.ElementRef }, { token: i0.Renderer2 }], target: i0.ɵɵFactoryTarget.Directive });
MdbMentionDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.2.7", type: MdbMentionDirective, selector: "input[mdbMention], textarea[mdbMention]", inputs: { placement: "placement", trigger: "trigger", outputKey: "outputKey", visibleItems: "visibleItems", disableFilter: "disableFilter", showListOnTrigger: "showListOnTrigger", asyncError: "asyncError", showImg: "showImg", noResultText: "noResultText", items: "items", queryBy: "queryBy", showNoResultText: "showNoResultText" }, outputs: { mentionChange: "mentionChange", mentionClose: "mentionClose", mentionOpen: "mentionOpen", mentionSelect: "mentionSelect" }, exportAs: ["mdbMention"], ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbMentionDirective, decorators: [{
            type: Directive,
            args: [{
                    // eslint-disable-next-line @angular-eslint/directive-selector
                    selector: 'input[mdbMention], textarea[mdbMention]',
                    exportAs: 'mdbMention',
                }]
        }], ctorParameters: function () { return [{ type: i1.Overlay }, { type: i1.OverlayPositionBuilder }, { type: i0.ElementRef }, { type: i0.Renderer2 }]; }, propDecorators: { placement: [{
                type: Input
            }], trigger: [{
                type: Input
            }], outputKey: [{
                type: Input
            }], visibleItems: [{
                type: Input
            }], disableFilter: [{
                type: Input
            }], showListOnTrigger: [{
                type: Input
            }], asyncError: [{
                type: Input
            }], showImg: [{
                type: Input
            }], noResultText: [{
                type: Input
            }], items: [{
                type: Input
            }], queryBy: [{
                type: Input
            }], showNoResultText: [{
                type: Input
            }], mentionChange: [{
                type: Output
            }], mentionClose: [{
                type: Output
            }], mentionOpen: [{
                type: Output
            }], mentionSelect: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudGlvbi5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9tZGItYW5ndWxhci1tZW50aW9uL3NyYy9saWIvbWVudGlvbi5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLHFCQUFxQixFQUNyQixvQkFBb0IsR0FFckIsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBR0wsYUFBYSxHQUdkLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFFTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEdBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7O0FBYTFELE1BQU0sT0FBTyxtQkFBbUI7SUEwSTlCLFlBQ1UsUUFBaUIsRUFDakIsdUJBQStDLEVBQy9DLFdBQXVCLEVBQ3ZCLFNBQW9CO1FBSHBCLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF3QjtRQUMvQyxnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQUN2QixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBN0l0QixnQkFBVyxHQUFzQixJQUFJLENBQUM7UUFFckMsY0FBUyxHQUF3QyxRQUFRLENBQUM7UUFDMUQsWUFBTyxHQUFzQixHQUFHLENBQUM7UUFRbEMsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQWFoQixrQkFBYSxHQUFHLENBQUMsQ0FBQztRQVNsQixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQVN2Qix1QkFBa0IsR0FB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SUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRTFCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDYixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQzs7Z0hBL2JVLG1CQUFtQjtvR0FBbkIsbUJBQW1COzJGQUFuQixtQkFBbUI7a0JBTC9CLFNBQVM7bUJBQUM7b0JBQ1QsOERBQThEO29CQUM5RCxRQUFRLEVBQUUseUNBQXlDO29CQUNuRCxRQUFRLEVBQUUsWUFBWTtpQkFDdkI7b0xBSVUsU0FBUztzQkFBakIsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBRUYsU0FBUztzQkFEWixLQUFLO2dCQVVGLFlBQVk7c0JBRGYsS0FBSztnQkFjRixhQUFhO3NCQURoQixLQUFLO2dCQVVGLGlCQUFpQjtzQkFEcEIsS0FBSztnQkFVRixVQUFVO3NCQURiLEtBQUs7Z0JBY0YsT0FBTztzQkFEVixLQUFLO2dCQWNGLFlBQVk7c0JBRGYsS0FBSztnQkFjRixLQUFLO3NCQURSLEtBQUs7Z0JBY0YsT0FBTztzQkFEVixLQUFLO2dCQWNGLGdCQUFnQjtzQkFEbkIsS0FBSztnQkFhYSxhQUFhO3NCQUEvQixNQUFNO2dCQUNZLFlBQVk7c0JBQTlCLE1BQU07Z0JBQ1ksV0FBVztzQkFBN0IsTUFBTTtnQkFDWSxhQUFhO3NCQUEvQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQm9vbGVhbklucHV0LFxuICBjb2VyY2VCb29sZWFuUHJvcGVydHksXG4gIGNvZXJjZU51bWJlclByb3BlcnR5LFxuICBOdW1iZXJJbnB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7XG4gIENvbm5lY3RlZFBvc2l0aW9uLFxuICBPdmVybGF5LFxuICBPdmVybGF5Q29uZmlnLFxuICBPdmVybGF5UG9zaXRpb25CdWlsZGVyLFxuICBPdmVybGF5UmVmLFxufSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQgeyBDb21wb25lbnRQb3J0YWwgfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcbmltcG9ydCB7XG4gIENvbXBvbmVudFJlZixcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgZnJvbUV2ZW50IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1kYk1lbnRpb25Db21wb25lbnQgfSBmcm9tICcuL21lbnRpb24uY29tcG9uZW50JztcblxuZXhwb3J0IGludGVyZmFjZSBNZGJNZW50aW9uQ2hhbmdlIHtcbiAgdHJpZ2dlcjogc3RyaW5nO1xuICBzZWFyY2hUZXJtOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWRiTWVudGlvblF1ZXJ5IHt9XG5ARGlyZWN0aXZlKHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9kaXJlY3RpdmUtc2VsZWN0b3JcbiAgc2VsZWN0b3I6ICdpbnB1dFttZGJNZW50aW9uXSwgdGV4dGFyZWFbbWRiTWVudGlvbl0nLFxuICBleHBvcnRBczogJ21kYk1lbnRpb24nLFxufSlcbmV4cG9ydCBjbGFzcyBNZGJNZW50aW9uRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIF9vdmVybGF5UmVmOiBPdmVybGF5UmVmIHwgbnVsbCA9IG51bGw7XG5cbiAgQElucHV0KCkgcGxhY2VtZW50OiAndG9wJyB8ICdib3R0b20nIHwgJ2xlZnQnIHwgJ3JpZ2h0JyA9ICdib3R0b20nO1xuICBASW5wdXQoKSB0cmlnZ2VyOiBzdHJpbmcgfCBzdHJpbmdbXSA9ICdAJztcbiAgQElucHV0KClcbiAgZ2V0IG91dHB1dEtleSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9vdXRwdXRLZXk7XG4gIH1cbiAgc2V0IG91dHB1dEtleSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fb3V0cHV0S2V5ID0gdmFsdWU7XG4gIH1cbiAgcHJpdmF0ZSBfb3V0cHV0S2V5ID0gJyc7XG5cbiAgQElucHV0KClcbiAgZ2V0IHZpc2libGVJdGVtcygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl92aXNpYmxlSXRlbXM7XG4gIH1cbiAgc2V0IHZpc2libGVJdGVtcyh2YWx1ZTogTnVtYmVySW5wdXQpIHtcbiAgICB0aGlzLl92aXNpYmxlSXRlbXMgPSBjb2VyY2VOdW1iZXJQcm9wZXJ0eSh2YWx1ZSk7XG5cbiAgICBpZiAodGhpcy5fbWVudGlvblJlZikge1xuICAgICAgdGhpcy5fbWVudGlvblJlZi5pbnN0YW5jZS52aXNpYmxlSXRlbXMgPSB0aGlzLl92aXNpYmxlSXRlbXM7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgX3Zpc2libGVJdGVtcyA9IDU7XG5cbiAgQElucHV0KClcbiAgZ2V0IGRpc2FibGVGaWx0ZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVGaWx0ZXI7XG4gIH1cbiAgc2V0IGRpc2FibGVGaWx0ZXIodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgIHRoaXMuX2Rpc2FibGVGaWx0ZXIgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICB9XG4gIHByaXZhdGUgX2Rpc2FibGVGaWx0ZXIgPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBnZXQgc2hvd0xpc3RPblRyaWdnZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3Nob3dMaXN0T25UcmlnZ2VyO1xuICB9XG4gIHNldCBzaG93TGlzdE9uVHJpZ2dlcih2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgdGhpcy5fc2hvd0xpc3RPblRyaWdnZXIgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICB9XG4gIHByaXZhdGUgX3Nob3dMaXN0T25UcmlnZ2VyID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBnZXQgYXN5bmNFcnJvcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fYXN5bmNFcnJvcjtcbiAgfVxuICBzZXQgYXN5bmNFcnJvcih2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgdGhpcy5fYXN5bmNFcnJvciA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG5cbiAgICBpZiAodGhpcy5fbWVudGlvblJlZikge1xuICAgICAgdGhpcy5fbWVudGlvblJlZi5pbnN0YW5jZS5hc3luY0Vycm9yID0gdGhpcy5fYXN5bmNFcnJvcjtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBfYXN5bmNFcnJvciA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBzaG93SW1nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zaG93SW1nO1xuICB9XG4gIHNldCBzaG93SW1nKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICB0aGlzLl9zaG93SW1nID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcblxuICAgIGlmICh0aGlzLl9tZW50aW9uUmVmKSB7XG4gICAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLnNob3dJbWcgPSB0aGlzLl9zaG93SW1nO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIF9zaG93SW1nID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgZ2V0IG5vUmVzdWx0VGV4dCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9ub1Jlc3VsdFRleHQ7XG4gIH1cbiAgc2V0IG5vUmVzdWx0VGV4dCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fbm9SZXN1bHRUZXh0ID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5fbWVudGlvblJlZikge1xuICAgICAgdGhpcy5fbWVudGlvblJlZi5pbnN0YW5jZS5ub1Jlc3VsdFRleHQgPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBfbm9SZXN1bHRUZXh0ID0gJ05vIHJlc3VsdCBmb3VuZCc7XG5cbiAgQElucHV0KClcbiAgZ2V0IGl0ZW1zKCk6IGFueVtdIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gIH1cbiAgc2V0IGl0ZW1zKHZhbHVlOiBhbnlbXSkge1xuICAgIHRoaXMuX2l0ZW1zID0gdmFsdWUgPyB2YWx1ZSA6IFtdO1xuXG4gICAgaWYgKHRoaXMuX21lbnRpb25SZWYpIHtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2UuaXRlbXMgPSB0aGlzLl9pdGVtcztcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBfaXRlbXM6IGFueVtdID0gW107XG5cbiAgQElucHV0KClcbiAgZ2V0IHF1ZXJ5QnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fcXVlcnlCeTtcbiAgfVxuICBzZXQgcXVlcnlCeSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fcXVlcnlCeSA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuX21lbnRpb25SZWYpIHtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2UucXVlcnlCeSA9IHRoaXMuX3F1ZXJ5Qnk7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgX3F1ZXJ5QnkgPSAndXNlcm5hbWUnO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBzaG93Tm9SZXN1bHRUZXh0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zaG93Tm9SZXN1bHRUZXh0O1xuICB9XG4gIHNldCBzaG93Tm9SZXN1bHRUZXh0KHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICB0aGlzLl9zaG93Tm9SZXN1bHRUZXh0ID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcblxuICAgIGlmICh0aGlzLl9tZW50aW9uUmVmKSB7XG4gICAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLnNob3dOb1Jlc3VsdFRleHQgPSB0aGlzLl9zaG93Tm9SZXN1bHRUZXh0O1xuICAgIH1cbiAgfVxuICBwcml2YXRlIF9zaG93Tm9SZXN1bHRUZXh0ID0gdHJ1ZTtcblxuICBAT3V0cHV0KCkgcmVhZG9ubHkgbWVudGlvbkNoYW5nZTogRXZlbnRFbWl0dGVyPE1kYk1lbnRpb25DaGFuZ2U+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgbWVudGlvbkNsb3NlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSByZWFkb25seSBtZW50aW9uT3BlbjogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgbWVudGlvblNlbGVjdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHJpdmF0ZSBfbWVudGlvblJlZjogQ29tcG9uZW50UmVmPE1kYk1lbnRpb25Db21wb25lbnQ+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgX29wZW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfY2FyZXRQb3NpdGlvbkluZGV4ID0gMDtcbiAgcHJpdmF0ZSBfaXNUcmlnZ2VyVmFsaWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfcHJlc2VudFRyaWdnZXIgPSAnJztcblxuICBtZW50aW9uVmFsdWUgPSAnJztcblxuICBwcml2YXRlIHJlYWRvbmx5IF9kZXN0cm95JDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfb3ZlcmxheTogT3ZlcmxheSxcbiAgICBwcml2YXRlIF9vdmVybGF5UG9zaXRpb25CdWlsZGVyOiBPdmVybGF5UG9zaXRpb25CdWlsZGVyLFxuICAgIHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMlxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2F1dG9jb21wbGV0ZScsICdvZmYnKTtcbiAgICB0aGlzLl9iaW5kVHJpZ2dlckV2ZW50cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0UG9zaXRpb24oKTogQ29ubmVjdGVkUG9zaXRpb25bXSB7XG4gICAgbGV0IHBvc2l0aW9uO1xuXG4gICAgY29uc3QgcG9zaXRpb25Ub3AgPSB7XG4gICAgICBvcmlnaW5YOiAnc3RhcnQnLFxuICAgICAgb3JpZ2luWTogJ3RvcCcsXG4gICAgICBvdmVybGF5WDogJ3N0YXJ0JyxcbiAgICAgIG92ZXJsYXlZOiAnYm90dG9tJyxcbiAgICAgIG9mZnNldFk6IDAsXG4gICAgfTtcblxuICAgIGNvbnN0IHBvc2l0aW9uQm90dG9tID0ge1xuICAgICAgb3JpZ2luWDogJ3N0YXJ0JyxcbiAgICAgIG9yaWdpblk6ICdib3R0b20nLFxuICAgICAgb3ZlcmxheVg6ICdzdGFydCcsXG4gICAgICBvdmVybGF5WTogJ3RvcCcsXG4gICAgICBvZmZzZXRZOiAwLFxuICAgIH07XG5cbiAgICBjb25zdCBwb3NpdGlvblJpZ2h0ID0ge1xuICAgICAgb3JpZ2luWDogJ2VuZCcsXG4gICAgICBvcmlnaW5ZOiAnY2VudGVyJyxcbiAgICAgIG92ZXJsYXlYOiAnc3RhcnQnLFxuICAgICAgb3ZlcmxheVk6ICdjZW50ZXInLFxuICAgICAgb2Zmc2V0WDogMCxcbiAgICB9O1xuXG4gICAgY29uc3QgcG9zaXRpb25MZWZ0ID0ge1xuICAgICAgb3JpZ2luWDogJ3N0YXJ0JyxcbiAgICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICAgb3ZlcmxheVg6ICdlbmQnLFxuICAgICAgb3ZlcmxheVk6ICdjZW50ZXInLFxuICAgICAgb2Zmc2V0WDogMCxcbiAgICB9O1xuXG4gICAgc3dpdGNoICh0aGlzLnBsYWNlbWVudCkge1xuICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgcG9zaXRpb24gPSBbcG9zaXRpb25Ub3AsIHBvc2l0aW9uQm90dG9tXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICBwb3NpdGlvbiA9IFtwb3NpdGlvbkJvdHRvbSwgcG9zaXRpb25Ub3BdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICBwb3NpdGlvbiA9IFtwb3NpdGlvbkxlZnQsIHBvc2l0aW9uUmlnaHRdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgcG9zaXRpb24gPSBbcG9zaXRpb25SaWdodCwgcG9zaXRpb25MZWZ0XTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBwb3NpdGlvbiA9IFtwb3NpdGlvbkJvdHRvbSwgcG9zaXRpb25Ub3BdO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gcG9zaXRpb247XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVPdmVybGF5Q29uZmlnKCk6IE92ZXJsYXlDb25maWcge1xuICAgIGNvbnN0IHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5UG9zaXRpb25CdWlsZGVyXG4gICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLl9lbGVtZW50UmVmKVxuICAgICAgLndpdGhQb3NpdGlvbnModGhpcy5fZ2V0UG9zaXRpb24oKSk7XG4gICAgY29uc3Qgb3ZlcmxheUNvbmZpZyA9IG5ldyBPdmVybGF5Q29uZmlnKHtcbiAgICAgIHdpZHRoOiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICBoYXNCYWNrZHJvcDogZmFsc2UsXG4gICAgICBzY3JvbGxTdHJhdGVneTogdGhpcy5fb3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLnJlcG9zaXRpb24oKSxcbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3ksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gb3ZlcmxheUNvbmZpZztcbiAgfVxuXG4gIHByaXZhdGUgX2NyZWF0ZU92ZXJsYXkoKTogdm9pZCB7XG4gICAgdGhpcy5fb3ZlcmxheVJlZiA9IHRoaXMuX292ZXJsYXkuY3JlYXRlKHRoaXMuX2NyZWF0ZU92ZXJsYXlDb25maWcoKSk7XG4gIH1cblxuICBwcml2YXRlIF9saXN0ZW5Ub091dFNpZGVDbGljayhcbiAgICBvdmVybGF5UmVmOiBPdmVybGF5UmVmLFxuICAgIG9yaWdpbjogSFRNTEVsZW1lbnRcbiAgKTogT2JzZXJ2YWJsZTxNb3VzZUV2ZW50PiB7XG4gICAgcmV0dXJuIGZyb21FdmVudChkb2N1bWVudCwgJ2NsaWNrJykucGlwZShcbiAgICAgIGZpbHRlcigoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBjb25zdCBub3RPcmlnaW4gPSB0YXJnZXQgIT09IG9yaWdpbjtcbiAgICAgICAgY29uc3Qgbm90T3ZlcmxheSA9ICEhb3ZlcmxheVJlZiAmJiBvdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50LmNvbnRhaW5zKHRhcmdldCkgPT09IGZhbHNlO1xuICAgICAgICByZXR1cm4gbm90T3JpZ2luICYmIG5vdE92ZXJsYXk7XG4gICAgICB9KSxcbiAgICAgIHRha2VVbnRpbChvdmVybGF5UmVmLmRldGFjaG1lbnRzKCkpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgX2hhbmRsZU9wdGlvbkNsaWNrKGl0ZW06IGFueSkge1xuICAgIHRoaXMubWVudGlvblNlbGVjdC5lbWl0KGl0ZW0pO1xuICAgIHRoaXMuX3NldEhvc3RWYWx1ZShpdGVtKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBwcml2YXRlIF9zZXREYXRhRm9yRHJvcGRvd24oKSB7XG4gICAgbGV0IGZpbHRlcmVkaXRlbXM6IGFueVtdO1xuXG4gICAgaWYgKCF0aGlzLl9kaXNhYmxlRmlsdGVyKSB7XG4gICAgICBmaWx0ZXJlZGl0ZW1zID0gdGhpcy5fZmlsdGVyKHRoaXMubWVudGlvblZhbHVlKTtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2UuaXRlbXMgPSBmaWx0ZXJlZGl0ZW1zID8gZmlsdGVyZWRpdGVtcyA6IHRoaXMuX2l0ZW1zO1xuICAgIH1cbiAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLm1lbnRpb25WYWx1ZSA9IHRoaXMubWVudGlvblZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlTWVudGlvblN0cmluZyhjYXJldFBvc2l0aW9uSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IGhvc3RWYWx1ZUJlZm9yZUNhcmV0ID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlLnNsaWNlKDAsIGNhcmV0UG9zaXRpb25JbmRleCk7XG4gICAgY29uc3QgdHJpZ2dlcnMgPSBbLi4udGhpcy50cmlnZ2VyXTtcblxuICAgIGlmICghdGhpcy5fY2FyZXRQb3NpdGlvbkluZGV4KSB7XG4gICAgICB0aGlzLm1lbnRpb25WYWx1ZSA9ICcnO1xuICAgICAgdGhpcy5faXNUcmlnZ2VyVmFsaWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gaG9zdFZhbHVlQmVmb3JlQ2FyZXQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGlmIChob3N0VmFsdWVCZWZvcmVDYXJldC5jaGFyQXQoaSkgPT09ICcgJykge1xuICAgICAgICB0aGlzLm1lbnRpb25WYWx1ZSA9ICcnO1xuICAgICAgICB0aGlzLl9pc1RyaWdnZXJWYWxpZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHJpZ2dlcnMuc29tZSgodHJpZ2dlcikgPT4gdHJpZ2dlciA9PT0gaG9zdFZhbHVlQmVmb3JlQ2FyZXQuY2hhckF0KGkpKSkge1xuICAgICAgICBpZiAoaG9zdFZhbHVlQmVmb3JlQ2FyZXQuY2hhckF0KGkgLSAxKSAhPT0gJyAnICYmIGkgPiAxKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdHJpZ2dlciA9IGhvc3RWYWx1ZUJlZm9yZUNhcmV0LmNoYXJBdChpKTtcbiAgICAgICAgY29uc3QgaG9zdFZhbHVlQWZ0ZXJUcmlnZ2VyID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlLnNsaWNlKGkpO1xuICAgICAgICBjb25zdCBtZW50aW9uVmFsdWVzID0gaG9zdFZhbHVlQWZ0ZXJUcmlnZ2VyLnNwbGl0KCcgJylbMF07XG4gICAgICAgIGNvbnN0IG1lbnRpb25WYWx1ZSA9IG1lbnRpb25WYWx1ZXMuc3BsaXQodHJpZ2dlcilbMV0gPyBtZW50aW9uVmFsdWVzLnNwbGl0KHRyaWdnZXIpWzFdIDogJyc7XG4gICAgICAgIHRoaXMubWVudGlvblZhbHVlID0gbWVudGlvblZhbHVlO1xuICAgICAgICB0aGlzLl9pc1RyaWdnZXJWYWxpZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3ByZXNlbnRUcmlnZ2VyID0gdHJpZ2dlcjtcblxuICAgICAgICB0aGlzLm1lbnRpb25DaGFuZ2UuZW1pdCh7XG4gICAgICAgICAgdHJpZ2dlcjogdHJpZ2dlcixcbiAgICAgICAgICBzZWFyY2hUZXJtOiB0aGlzLm1lbnRpb25WYWx1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF90b2dnbGVEcm9wZG93bigpIHtcbiAgICBpZiAoIXRoaXMuX29wZW4gJiYgdGhpcy5faXNUcmlnZ2VyVmFsaWQpIHtcbiAgICAgIGlmICghdGhpcy5fc2hvd0xpc3RPblRyaWdnZXIgJiYgdGhpcy5tZW50aW9uVmFsdWUubGVuZ3RoIDwgMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2UucXVlcnlCeSA9IHRoaXMucXVlcnlCeTtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2Uubm9SZXN1bHRUZXh0ID0gdGhpcy5fbm9SZXN1bHRUZXh0O1xuICAgICAgdGhpcy5fbWVudGlvblJlZi5pbnN0YW5jZS5zaG93Tm9SZXN1bHRUZXh0ID0gdGhpcy5fc2hvd05vUmVzdWx0VGV4dDtcbiAgICAgIHRoaXMuX21lbnRpb25SZWYuaW5zdGFuY2UuYXN5bmNFcnJvciA9IHRoaXMuX2FzeW5jRXJyb3I7XG4gICAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLnNob3dJbWcgPSB0aGlzLl9zaG93SW1nO1xuICAgICAgdGhpcy5fbWVudGlvblJlZi5pbnN0YW5jZS52aXNpYmxlSXRlbXMgPSB0aGlzLl92aXNpYmxlSXRlbXM7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9pc1RyaWdnZXJWYWxpZCkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2hhbmRsZURyb3Bkb3duQnlDYXJldChldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICB0aGlzLl9jYXJldFBvc2l0aW9uSW5kZXggPSB0YXJnZXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgdGhpcy5fdXBkYXRlTWVudGlvblN0cmluZyh0aGlzLl9jYXJldFBvc2l0aW9uSW5kZXgpO1xuXG4gICAgdGhpcy5fdG9nZ2xlRHJvcGRvd24oKTtcbiAgICBpZiAoIXRoaXMuX29wZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9zZXREYXRhRm9yRHJvcGRvd24oKTtcbiAgfVxuXG4gIHByaXZhdGUgX2JpbmRUcmlnZ2VyRXZlbnRzKCk6IHZvaWQge1xuICAgIGZyb21FdmVudCh0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjbGljaycpXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMuX2hhbmRsZURyb3Bkb3duQnlDYXJldChldmVudCk7XG4gICAgICB9KTtcblxuICAgIGZyb21FdmVudCh0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdrZXlkb3duJylcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCB7IGtleSB9ID0gZXZlbnQ7XG5cbiAgICAgICAgY29uc3QgaXNLZXlFc2NhcGUgPSBrZXkgPT09ICdFc2NhcGUnO1xuICAgICAgICBjb25zdCBpc0tleVJlc3BvbnNpYmxlRm9yVGFib3V0ID0ga2V5ID09PSAnVGFiJztcbiAgICAgICAgY29uc3QgaXNLZXlSZXNwb25zaWJsZUZvckRyb3Bkb3duTmF2aWdhdGlvbiA9XG4gICAgICAgICAgWydBcnJvd1VwJywgJ0Fycm93RG93bicsICdFc2NhcGUnLCAnSG9tZScsICdFbmQnLCAnRW50ZXInXS5pbmRleE9mKGtleSkgPiAtMTtcbiAgICAgICAgaWYgKGlzS2V5UmVzcG9uc2libGVGb3JEcm9wZG93bk5hdmlnYXRpb24pIHtcbiAgICAgICAgICBpZiAoaXNLZXlFc2NhcGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNLZXlSZXNwb25zaWJsZUZvclRhYm91dCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX2hhbmRsZURyb3Bkb3duQnlDYXJldChldmVudCk7XG4gICAgICAgIH0sIDApO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9zZXRIb3N0VmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGhvc3RWYWx1ZUJlZm9yZUNhcmV0ID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlLnNsaWNlKFxuICAgICAgMCxcbiAgICAgIHRoaXMuX2NhcmV0UG9zaXRpb25JbmRleFxuICAgICk7XG4gICAgZm9yIChsZXQgaSA9IGhvc3RWYWx1ZUJlZm9yZUNhcmV0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBpZiAoaG9zdFZhbHVlQmVmb3JlQ2FyZXQuY2hhckF0KGkpID09PSAnICcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGhvc3RWYWx1ZUJlZm9yZUNhcmV0LmNoYXJBdChpKSA9PT0gdGhpcy5fcHJlc2VudFRyaWdnZXIpIHtcbiAgICAgICAgY29uc3QgaG9zdFZhbHVlQmVmb3JlVHJpZ2dlciA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZS5zbGljZSgwLCBpKTtcbiAgICAgICAgY29uc3QgaG9zdFZhbHVlQWZ0ZXJUcmlnZ2VyID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlLnNsaWNlKGkpO1xuICAgICAgICBjb25zdCBob3N0TmV3VmFsdWVBZnRlclRyaWdnZXIgPSBob3N0VmFsdWVBZnRlclRyaWdnZXIuc3BsaXQoJyAnKVsxXVxuICAgICAgICAgID8gaG9zdFZhbHVlQWZ0ZXJUcmlnZ2VyLnNwbGl0KCcgJykuc3BsaWNlKDEpLmpvaW4oJyAnKVxuICAgICAgICAgIDogJyc7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZSA9IGhvc3RWYWx1ZUJlZm9yZVRyaWdnZXIuY29uY2F0KFxuICAgICAgICAgIHRoaXMuX3ByZXNlbnRUcmlnZ2VyLFxuICAgICAgICAgIHZhbHVlW3RoaXMuX291dHB1dEtleSA/IHRoaXMuX291dHB1dEtleSA6IHRoaXMuX3F1ZXJ5QnldLFxuICAgICAgICAgICcgJyxcbiAgICAgICAgICBob3N0TmV3VmFsdWVBZnRlclRyaWdnZXJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9maWx0ZXIodmFsdWU6IHN0cmluZyk6IGFueVtdIHtcbiAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZmlsdGVyZWRpdGVtcyA9IHRoaXMuX2l0ZW1zLmZpbHRlcigoaXRlbTogYW55KSA9PlxuICAgICAgaXRlbVt0aGlzLl9xdWVyeUJ5XS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlclZhbHVlKVxuICAgICk7XG4gICAgcmV0dXJuIGZpbHRlcmVkaXRlbXM7XG4gIH1cblxuICBvcGVuKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9vcGVuKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl9vdmVybGF5UmVmKSB7XG4gICAgICB0aGlzLl9jcmVhdGVPdmVybGF5KCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX292ZXJsYXlSZWYuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgdGhpcy5fb3ZlcmxheVJlZi5kZXRhY2goKTtcbiAgICB9XG5cbiAgICBjb25zdCBtZW50aW9uUG9ydGFsID0gbmV3IENvbXBvbmVudFBvcnRhbChNZGJNZW50aW9uQ29tcG9uZW50KTtcbiAgICB0aGlzLl9tZW50aW9uUmVmID0gdGhpcy5fb3ZlcmxheVJlZi5hdHRhY2gobWVudGlvblBvcnRhbCk7XG4gICAgdGhpcy5fb3BlbiA9IHRydWU7XG5cbiAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLm9wdGlvbkNsaWNrLnN1YnNjcmliZSgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlT3B0aW9uQ2xpY2soaXRlbSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9tZW50aW9uUmVmLmluc3RhbmNlLnRhYm91dC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fbGlzdGVuVG9PdXRTaWRlQ2xpY2sodGhpcy5fb3ZlcmxheVJlZiwgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5zdWJzY3JpYmUoKCkgPT5cbiAgICAgIHRoaXMuY2xvc2UoKVxuICAgICk7XG4gICAgdGhpcy5tZW50aW9uT3Blbi5lbWl0KCk7XG4gIH1cblxuICBjbG9zZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fb3ZlcmxheVJlZikge1xuICAgICAgaWYgKHRoaXMuX292ZXJsYXlSZWYuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgICB0aGlzLl9vdmVybGF5UmVmLmRldGFjaCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9vcGVuKSB7XG4gICAgICB0aGlzLl9vcGVuID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5tZW50aW9uQ2xvc2UuZW1pdCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3kkLmNvbXBsZXRlKCk7XG5cbiAgICBpZiAodGhpcy5fb3ZlcmxheVJlZikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5fb3ZlcmxheVJlZi5kaXNwb3NlKCk7XG4gICAgICB0aGlzLl9vdmVybGF5UmVmID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==